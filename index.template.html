<!DOCTYPE html>
<html lang="de" class="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>uebertre1ber Dashboard // PRO</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap"
    rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        fontFamily: {
          sans: ['Inter', 'sans-serif'],
          mono: ['JetBrains Mono', 'monospace'],
        },
        extend: {
          colors: {
            faceit: '#FF5500',
            dark: '#050510',
            'neon-blue': '#00f2ff',
            'neon-purple': '#bd00ff',
            'glass-border': 'rgba(255, 255, 255, 0.05)',
            'glass-bg': 'rgba(20, 20, 30, 0.4)',
          },
          backgroundImage: {
            'cyber-gradient': 'linear-gradient(135deg, rgba(5,5,16,1) 0%, rgba(10,10,30,1) 50%, rgba(5,5,16,1) 100%)',
          },
          boxShadow: {
            'neon': '0 0 10px rgba(0, 242, 255, 0.3), 0 0 20px rgba(0, 242, 255, 0.1)',
            'neon-orange': '0 0 10px rgba(255, 85, 0, 0.3), 0 0 20px rgba(255, 85, 0, 0.1)',
          }
        }
      }
    }
  </script>
  <style>
    body {
      background-color: #050510;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(0, 242, 255, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 90% 80%, rgba(189, 0, 255, 0.05) 0%, transparent 40%);
      background-attachment: fixed;
    }

    /* Glassmorphism */
    .glass-panel {
      background: rgba(20, 20, 30, 0.6);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.03);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .glass-card:hover {
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(0, 242, 255, 0.2);
      box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
    }

    /* Table Styling */
    table {
      border-collapse: separate;
      border-spacing: 0 8px;
      /* Gap between rows */
      width: 100%;
    }

    th {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, 0.4);
      font-size: 0.75rem;
      padding: 1rem;
    }

    td {
      padding: 1rem;
    }

    tr.player-row td:first-child {
      border-top-left-radius: 12px;
      border-bottom-left-radius: 12px;
    }

    tr.player-row td:last-child {
      border-top-right-radius: 12px;
      border-bottom-right-radius: 12px;
    }

    tr.details-row td {
      border-radius: 12px;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #050510;
    }

    ::-webkit-scrollbar-thumb {
      background: #333;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #FF5500;
    }

    /* Utilities */
    .text-glow {
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    .text-glow-blue {
      text-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
    }

    .text-glow-orange {
      text-shadow: 0 0 10px rgba(255, 85, 0, 0.5);
    }

    .level-badge {
      clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
    }
  </style>
</head>

<body class="min-h-screen text-gray-200 font-sans selection:bg-neon-blue selection:text-black">

  <!-- Background Mesh -->
  <div class="fixed inset-0 pointer-events-none z-[-1] overflow-hidden">
    <div class="absolute top-[-20%] left-[20%] w-[60%] h-[60%] bg-blue-500/5 rounded-full blur-[150px] animate-pulse">
    </div>
    <div class="absolute bottom-[-20%] right-[20%] w-[60%] h-[60%] bg-purple-500/5 rounded-full blur-[150px]"
      style="animation-delay: 2s"></div>
  </div>

  <!-- Header -->
  <header class="py-10 flex flex-col items-center justify-center gap-6 relative">
    <div class="absolute top-0 w-full h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>

    <div class="relative group cursor-pointer hover:scale-105 transition-transform duration-500">
      <div
        class="absolute -inset-2 bg-gradient-to-r from-faceit to-orange-600 rounded-full blur-xl opacity-20 group-hover:opacity-40 transition duration-500">
      </div>
      <img src="icons/levels/uebertreiber_logo.png" alt="uebertre1ber" class="relative w-64 md:w-80 drop-shadow-2xl" />
    </div>

    <!-- Hero Stats Grid -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 w-full max-w-5xl px-4 mt-4">
      <!-- Stat Card 1: The King -->
      <div class="glass-panel p-4 rounded-xl flex items-center gap-4 relative overflow-hidden group">
        <div
          class="absolute right-0 top-0 w-24 h-24 bg-yellow-500/10 rounded-full blur-2xl -mr-10 -mt-10 group-hover:bg-yellow-500/20 transition">
        </div>
        <div class="w-12 h-12 rounded-lg bg-yellow-500/10 flex items-center justify-center text-2xl">ðŸ‘‘</div>
        <div>
          <p class="text-xs uppercase tracking-widest text-white/40 font-bold">The King</p>
          <p id="hero-king-name" class="font-bold text-white text-lg tracking-tight">â€”</p>
          <p id="hero-king-elo" class="font-mono text-yellow-500 text-sm">0 ELO</p>
        </div>
      </div>

      <!-- Stat Card 2: MVP (Highest Diff) -->
      <div class="glass-panel p-4 rounded-xl flex items-center gap-4 relative overflow-hidden group">
        <div
          class="absolute right-0 top-0 w-24 h-24 bg-green-500/10 rounded-full blur-2xl -mr-10 -mt-10 group-hover:bg-green-500/20 transition">
        </div>
        <div class="w-12 h-12 rounded-lg bg-green-500/10 flex items-center justify-center text-2xl">ðŸ”¥</div>
        <div>
          <p class="text-xs uppercase tracking-widest text-white/40 font-bold">MVP</p>
          <p id="hero-mvp-name" class="font-bold text-white text-lg tracking-tight">â€”</p>
          <p id="hero-mvp-diff" class="font-mono text-green-400 text-sm">+0</p>
        </div>
      </div>

      <!-- Stat Card 3: Opfer (Lowest Diff) -->
      <div class="glass-panel p-4 rounded-xl flex items-center gap-4 relative overflow-hidden group">
        <div
          class="absolute right-0 top-0 w-24 h-24 bg-red-500/10 rounded-full blur-2xl -mr-10 -mt-10 group-hover:bg-red-500/20 transition">
        </div>
        <div class="w-12 h-12 rounded-lg bg-red-500/10 flex items-center justify-center text-2xl">ðŸ’€</div>
        <div>
          <p class="text-xs uppercase tracking-widest text-white/40 font-bold">Opfer</p>
          <p id="hero-down-name" class="font-bold text-white text-lg tracking-tight">â€”</p>
          <p id="hero-down-diff" class="font-mono text-red-400 text-sm">-0</p>
        </div>
      </div>

      <!-- Stat Card 4: Total Matches -->
      <div class="glass-panel p-4 rounded-xl flex items-center gap-4 relative overflow-hidden group">
        <div
          class="absolute right-0 top-0 w-24 h-24 bg-blue-500/10 rounded-full blur-2xl -mr-10 -mt-10 group-hover:bg-blue-500/20 transition">
        </div>
        <div class="w-12 h-12 rounded-lg bg-blue-500/10 flex items-center justify-center text-2xl">ðŸ“Š</div>
        <div>
          <p class="text-xs uppercase tracking-widest text-white/40 font-bold">Tracked</p>
          <p class="font-bold text-white text-lg tracking-tight"><span
              class="text-blue-400"><!-- INSERT_PLAYER_COUNT --></span> Players</p>
          <p class="text-xs text-white/30">Live Updates</p>
        </div>
      </div>
    </div>
  </header>

  <main class="flex-grow w-full max-w-7xl mx-auto p-4 flex flex-col gap-6 z-10">

    <!-- Controls Toolbar -->
    <div class="flex justify-end items-center px-2">
      <div
        class="flex items-center gap-2 bg-[#0a0a14]/80 p-1.5 rounded-xl border border-gray-700/50 shadow-lg backdrop-blur-sm">
        <button
          class="time-filter active px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-all bg-white/10 text-white shadow-inner"
          data-val="daily">Daily</button>
        <button
          class="time-filter px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider text-gray-400 hover:text-white hover:bg-white/5 transition-all"
          data-val="weekly">Weekly</button>
        <button
          class="time-filter px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider text-gray-400 hover:text-white hover:bg-white/5 transition-all"
          data-val="monthly">Monthly</button>
        <button
          class="time-filter px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider text-gray-400 hover:text-white hover:bg-white/5 transition-all"
          data-val="yearly">Yearly</button>
      </div>
    </div>

    <!-- Main Table Area -->
    <div class="overflow-x-auto pb-10 px-2">
      <table class="w-full">
        <thead>
          <tr class="text-xs uppercase tracking-wider text-white/30 text-left">
            <th data-sort="nickname" class="p-4 cursor-pointer hover:text-white transition-colors font-medium">Player
            </th>
            <th data-sort="elo" class="p-4 cursor-pointer hover:text-white transition-colors font-medium">ELO</th>
            <th data-sort="diff" class="p-4 cursor-pointer hover:text-white transition-colors font-medium text-center">
              Gain</th>
            <th data-sort="level" class="p-4 cursor-pointer hover:text-white transition-colors font-medium text-center">
              Lvl</th>
            <th data-sort="winrate" class="p-4 cursor-pointer hover:text-white transition-colors font-medium">
              Performance (Last 30)</th>
            <th data-sort="matches"
              class="p-4 cursor-pointer hover:text-white transition-colors font-medium text-right">Matches</th>
            <th data-sort="last" class="p-4 cursor-pointer hover:text-white transition-colors font-medium text-right">
              Last Match</th>
          </tr>
        </thead>
        <tbody id="playerTableBody" class="space-y-2">
          <!-- INSERT_ELO_TABLE_HERE -->
        </tbody>
      </table>
    </div>

    <div class="text-center text-xs text-white/20 mt-4 mb-4">
      Last Update: <span class="text-white/40 font-mono"><!-- INSERT_LAST_UPDATED --></span>
    </div>

  </main>

  <!-- Footer -->
  <footer class="py-6 text-center z-10 relative">
    <div
      class="inline-flex items-center gap-2 px-4 py-2 rounded-full glass-panel text-xs text-white/40 hover:text-white/60 transition-colors">
      <span>Dashboard by <a href="https://www.faceit.com/de/players/sha-" target="_blank"
          class="font-bold text-white hover:text-neon-blue transition-colors">sha</a></span>
    </div>
  </footer>

  <script>window.ELO_DATA = null;</script>
  <!-- INSERT_HISTORY_DATA -->

  <script>
    // --- State ---
    let currentRange = 'daily';
    let currentSort = { col: 'elo', asc: false };

    // --- DOM Elements ---
    const tableBody = document.getElementById('playerTableBody');
    // Search removed as per user request
    const filterButtons = document.querySelectorAll('.time-filter');

    // --- Init ---
    filterButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        // Update UI
        filterButtons.forEach(b => {
          b.className = "time-filter px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider text-gray-400 hover:text-white hover:bg-white/5 transition-all";
        });
        btn.className = "time-filter active px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-all bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-neon";

        currentRange = btn.dataset.val;
        updateView();
      });
    });

    // Sort Headers
    document.querySelectorAll('th[data-sort]').forEach(th => {
      th.addEventListener('click', () => {
        const col = th.dataset.sort;
        if (currentSort.col === col) {
          currentSort.asc = !currentSort.asc;
        } else {
          currentSort.col = col;
          currentSort.asc = false; // Default desc for stats
        }
        sortRows(currentSort.col, currentSort.asc);
        updateViewHeaders();
      });
    });

    function updateViewHeaders() {
      document.querySelectorAll('th[data-sort]').forEach(th => {
        th.classList.remove('text-white', 'text-neon-blue');
        if (th.dataset.sort === currentSort.col) {
          th.classList.add('text-neon-blue');
          // Optional: Add arrow indicator
        }
      });
    }

    // --- Core Logic ---
    function updateView() {
      // 1. Calculate Diffs & Update DOM
      try {
        const snap = window.ELO_DATA ? window.ELO_DATA[currentRange] : null;
        if (!snap) return;

        const lookup = Object.fromEntries(snap.map(p => [p.playerId, p.elo]));
        let bestDiff = -9999;
        let worstDiff = 9999;
        let mvpName = "â€”";
        let downName = "â€”";
        let kingElo = -1;
        let kingName = "â€”";

        document.querySelectorAll("tr.player-row").forEach((row, index) => {
          // Ensure display is reset (in case search hid it previously)
          row.style.display = '';

          const pid = row.dataset.playerId;
          const currentElo = parseInt(row.dataset.elo || 0);
          const name = row.querySelector('.nickname-link').textContent.trim();

          // King Logic
          if (currentElo > kingElo) {
            kingElo = currentElo;
            kingName = name;
          }

          const prev = lookup[pid];
          const cell = row.querySelector(".elo-diff");
          let diffVal = 0;

          if (prev == null) {
            cell.innerHTML = '<span class="text-white/20">â€”</span>';
          } else {
            const diff = currentElo - prev;
            diffVal = diff;
            const isPlus = diff > 0;
            const isZero = diff === 0;
            const color = isPlus ? 'text-green-400' : (isZero ? 'text-gray-500' : 'text-red-400');
            const bg = isPlus ? 'bg-green-500/10' : (isZero ? 'bg-white/5' : 'bg-red-500/10');
            const sign = isPlus ? '+' : '';

            cell.innerHTML = `<div class="inline-flex items-center justify-center min-w-[3rem] px-2 py-1 rounded-md ${bg} ${color} font-mono font-bold text-sm border border-white/5 shadow-inner">${sign}${diff}</div>`;
          }

          // Update data-diff attribute for sorting
          row.dataset.diff = diffVal;

          // Stats Tracking
          if (diffVal > bestDiff) { bestDiff = diffVal; mvpName = name; }
          if (diffVal < worstDiff) { worstDiff = diffVal; downName = name; }
        });

        // Placeholder if no one is down bad
        if (worstDiff >= 0) {
          downName = "â€”";
          worstDiff = 0;
        }

        // 2. Sort
        sortRows(currentSort.col, currentSort.asc);

        // 3. Update Hero
        document.getElementById('hero-king-name').textContent = kingName;
        document.getElementById('hero-king-elo').textContent = kingElo + " ELO";

        document.getElementById('hero-mvp-name').textContent = mvpName;
        document.getElementById('hero-mvp-diff').textContent = (bestDiff > 0 ? "+" : "") + bestDiff;
        document.getElementById('hero-mvp-diff').className = `font-mono text-sm ${bestDiff >= 0 ? 'text-green-400' : 'text-red-400'}`;

        document.getElementById('hero-down-name').textContent = downName;
        document.getElementById('hero-down-diff').textContent = (worstDiff > 0 ? "+" : "") + worstDiff;

      } catch (e) { console.error(e); }
    }

    function sortRows(col, asc) {
      const rows = Array.from(document.querySelectorAll('.player-row'));
      const container = document.getElementById('playerTableBody');

      rows.sort((a, b) => {
        const valA = getVal(a, col);
        const valB = getVal(b, col);

        if (valA < valB) return asc ? -1 : 1;
        if (valA > valB) return asc ? 1 : -1;
        return 0;
      });

      // Re-append in order (also moving their details rows!)
      rows.forEach(row => {
        container.appendChild(row);
        const pid = row.dataset.playerId;
        const details = document.querySelector(`.details-row[data-player-id="${pid}"]`);
        if (details) container.appendChild(details);
      });

      updateViewHeaders();
    }

    function getVal(row, col) {
      if (col === 'elo') return parseInt(row.dataset.elo || 0);
      if (col === 'nickname') return (row.dataset.nickname || "").toLowerCase();
      if (col === 'diff') return parseInt(row.dataset.diff || 0);
      if (col === 'level') return parseInt(row.dataset.level || 0);
      if (col === 'winrate') return parseFloat(row.dataset.winrate || 0);
      if (col === 'matches') return parseInt(row.dataset.matches || 0);
      if (col === 'last') return row.dataset.last || "";
      return 0;
    }

    // --- Details Toggle & Chart ---
    const charts = {};

    document.addEventListener("click", e => {
      // Ignore clicks on links (nickname, mates)
      if (e.target.closest("a")) return;

      // Toggle on row click
      const row = e.target.closest("tr.player-row");
      if (!row) return;

      const pid = row.dataset.playerId;
      const toggle = row.querySelector(".toggle-details");
      const detailRow = document.querySelector(`tr.details-row[data-player-id="${pid}"]`);

      if (detailRow) {
        detailRow.classList.toggle("hidden");
        const isHidden = detailRow.classList.contains("hidden");

        if (toggle) toggle.style.transform = isHidden ? "rotate(0deg)" : "rotate(90deg)";

        if (!isHidden) {
          // Init Chart
          if (!charts[pid]) {
            const canvas = detailRow.querySelector("canvas");
            if (canvas) {
              const hist = JSON.parse(canvas.dataset.history || "[]");
              if (hist.length) {
                const ctx = canvas.getContext('2d');
                // Create Gradient
                const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, 'rgba(0, 242, 255, 0.2)');
                gradient.addColorStop(1, 'rgba(0, 242, 255, 0)');

                charts[pid] = new Chart(ctx, {
                  type: 'line',
                  data: {
                    labels: hist.map(h => new Date(h.date * 1000).toLocaleDateString()),
                    datasets: [{
                      data: hist.map(h => h.elo),
                      borderColor: '#00f2ff',
                      backgroundColor: gradient,
                      borderWidth: 2,
                      pointBackgroundColor: '#00f2ff',
                      pointRadius: 0,
                      pointHoverRadius: 6,
                      fill: true,
                      tension: 0.4
                    }]
                  },
                  options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                      mode: 'index',
                      intersect: false,
                    },
                    plugins: {
                      legend: { display: false },
                      tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(5, 5, 16, 0.9)',
                        titleColor: '#fff',
                        bodyColor: '#00f2ff',
                        borderColor: 'rgba(255,255,255,0.1)',
                        borderWidth: 1
                      }
                    },
                    scales: {
                      x: { display: false },
                      y: {
                        grid: { color: 'rgba(255,255,255,0.05)' },
                        ticks: { color: '#666' }
                      }
                    }
                  }
                });
              }
            }
          }
        }
      }
    });

    // Startup
    updateView(); // Run once

  </script>
</body>

</html>